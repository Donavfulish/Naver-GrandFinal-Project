generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  password_hash String
  avatar_url    String?
  is_deleted    Boolean  @default(false)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  spaces Space[]

  @@map("users")
}

model Space {
  id            String   @id @default(uuid())
  user_id       String
  name          String
  description   String?
  mood          String
  background_id String?
  clock_font_id String?
  text_font_id  String?
  duration      Int      @default(0) // Seconds
  is_deleted    Boolean  @default(false)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  user       User        @relation(fields: [user_id], references: [id])
  clock      ClockFont?  @relation(fields: [clock_font_id], references: [id])
  text       TextFont?   @relation(fields: [text_font_id], references: [id])
  background Background? @relation(fields: [background_id], references: [id])

  playlists          Playlist[]
  space_tags         SpaceTag[]
  notes              Note[]
  AiGeneratedContent AiGeneratedContent?

  @@index([user_id])
  @@index([background_id])
  @@index([clock_font_id])
  @@index([text_font_id])
  @@map("spaces")
}

enum BackgroundSource {
  USER
  SYSTEM
}

model Playlist {
  id         String   @id @default(uuid())
  space_id   String?
  name       String
  is_deleted Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  space           Space?          @relation(fields: [space_id], references: [id])
  playlist_tracks PlaylistTrack[]

  @@index([space_id])
  @@map("playlists")
}

enum TrackSource {
  SYSTEM
  USER
}

model Background {
  id             String           @id @default(uuid())
  background_url String
  emotion        String[]         @default([])
  tags           String[]         @default([])
  source         BackgroundSource @default(USER)
  is_deleted     Boolean          @default(false)
  created_at     DateTime         @default(now())
  updated_at     DateTime         @default(now())

  spaces Space[]

  @@map("backgrounds")
}

model Track {
  id         String      @id @default(uuid())
  name       String
  thumbnail  String?
  track_url  String
  emotion    String[]    @default([])
  tags       String[]    @default([])
  source     TrackSource @default(SYSTEM)
  is_deleted Boolean     @default(false)
  created_at DateTime    @default(now())
  updated_at DateTime    @default(now())

  playlist_tracks PlaylistTrack[]

  @@map("tracks")
}

model Note {
  id         String   @id @default(uuid())
  space_id   String
  content    String
  note_order Int
  is_deleted Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  space Space @relation(fields: [space_id], references: [id])

  @@index([space_id])
  @@map("notes")
}

model Tag {
  id         String   @id @default(uuid())
  name       String   @unique
  is_deleted Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  space_tags SpaceTag[]

  @@map("tags")
}

model ClockFont {
  id         String   @id @default(uuid())
  style      String
  is_deleted Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  spaces Space[]

  @@map("clock_fonts")
}

model TextFont {
  id         String   @id @default(uuid())
  font_name  String
  is_deleted Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  spaces Space[]

  @@map("text_fonts")
}

model PlaylistTrack {
  id          String   @id @default(uuid())
  playlist_id String
  track_id    String
  track_order Int
  is_deleted  Boolean  @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())

  playlist Playlist @relation(fields: [playlist_id], references: [id])
  track    Track    @relation(fields: [track_id], references: [id])

  @@unique([playlist_id, track_id])
  @@index([playlist_id, track_order])
  @@map("playlist_tracks")
}

model SpaceTag {
  id         String   @id @default(uuid())
  space_id   String
  tag_id     String
  is_deleted Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  space Space @relation(fields: [space_id], references: [id])
  tag   Tag   @relation(fields: [tag_id], references: [id])

  @@unique([space_id, tag_id])
  @@index([tag_id])
  @@index([space_id])
  @@map("space_tags")
}

model AiGeneratedContent {
  id         String   @id @default(uuid())
  space_id   String   @unique // 1-1: mỗi space chỉ có 1 AI content
  prompt     String?
  content    String
  is_deleted Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  space Space @relation(fields: [space_id], references: [id])

  @@index([space_id])
  @@map("ai_generated_contents")
}
